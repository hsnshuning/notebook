# B+树
B+树

## 插入
插入会触发结点分裂，根据结点的元素数和左右兄弟结点的元素数来作为分裂的依据。分为3种情况
1. 叶节点没满，索引节点没满，直接插入到叶子结点，索引节点。
2. 叶子结点满了，索引节点没满，叶子结点分裂，将分裂的中间结点放到索引节点中，小于中间节点放左边叶子结点，大于或等于中间节点放右边叶子结点。
3. 叶子结点和索引节点都满了，走情况2拆分叶子结点，然后拆分索引节点，与拆分叶子结点规则一样，拆分之后把拆分的中间结点放到上一层，上一层没有了就生长一层。
可以看出b+树的维护相对简单，进行结点的分裂就可以了，但是b+树一般会用于数据库存储，如果进行结点分裂，就相当于做了页分裂，是要磁盘IO的，这样的话效率就会大大降低，所以b+树用旋转操作代替可能出现的结点分裂。

## 分裂
在innodb中，b+树进行分裂时不一定是在中间节点开始分裂，因为如果每次都在中间节点进行分裂的话，顺序插入时就会导致页的利用率只有百分之50了，innodb通过记录插入的方向和向同一方向插入的数量来解决这个问题，如果同一方向插入大于一定值就会从新插入的地方分裂，以此来保证页的利用率。

## 旋转
如果叶子结点已经满了但是左右兄弟结点没满，会进行类似于左旋和右旋的操作，把结点上一个元素移到左右兄弟结点上，优先左兄弟。

## 删除
删除会触发结点合并，根据结点的填充因子来作为合并的依据。根据分为3种情况
1. 删除后叶子结点不小于填充因子，索引节点不小于填充因子，直接删除，如果该节点在索引节点内就用该节点元素的右边的节点元素代替。
2. 删除后叶子结点小于填充因子，索引节点不小于填充因子，合并叶子结点和它的兄弟结点，同时更新索引节点。
3. 删除后叶子结点小于填充因子，索引节点小于填充因子，合并叶子结点和它兄弟结点，更新索引节点，继续合并索引节点和它的兄弟结点以此类推。
