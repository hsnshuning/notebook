# golang垃圾收集算法
golang的垃圾回收算法是三色标记+混合写屏障。

# 三色标记
三色标记法把对内存对象分为三种类型：
1. 黑色是从根对象可达正在活跃的不能进行回收的对象。
2. 灰色也是活跃的，从根对象可达的，他可能还包含一些没有扫描过的外部指针。
3. 白色对象是潜在的垃圾对象，可能是从根对象不可达的垃圾或者是还没扫描到。

# Go垃圾回收算法
go的垃圾回收器的工作原理是：
1. 从根对象开始把根对象染灰放到灰色集合。
2. 从灰色集合取出灰色对象染黑，把灰色对象指向的对象都标记为灰色放到集合。
3. 然后再从灰色集合拿灰色对象，一直重复，直到灰色集合没有对象了。

# 三色不变性
三色标记算法一样是会有STW的，为了让垃圾回收程序与用户程序并发并且增量的进行标记，从而减少总标记时间和一次STW时间，垃圾收集器通过写屏障技术保证进行并发，增量的标记的同时满足三色不变性，通过三色不变性来保证并发和增量时的内存安全。三色不变性是指
1. 强三色不变性：黑色对象不会指向白色对象。
2. 弱三色不变性：黑色对象可以指向白色对象，但是白色对象必须要有一个可以从灰色对象过去路径。

# 屏障技术
写屏障分为插入写屏障和删除写屏障，go考虑到性能影响没有对所有根对象开启写屏障，而是在标记完成阶段
1. 插入写屏障：在一个黑色对象的指针指向白色对象的时候，把这个白色对象染灰，以此满足强三色不变性
2. 删除写屏障：在一个对象指向另一个对象的指针被删除时，把被删除指向的对象染灰，以此满足弱三色不变性