# 索引并发
## 蟹行协议
蟹行协议名字来源于螃蟹走路的方式：先移动一边的腿再移动另一条腿，如此交替。
* 插入：搜索一条记录，先在根节点加S锁，然后获取子节点S锁，拿到子节点S锁后释放根节点S锁，最后到叶子结点，释放掉叶子结点的S锁，给叶子结点加上X锁，然后进行插入或删除。
* 分裂：当需要进行分裂时，将父节点用X锁锁住，避免其他事务并发查询，然后进行节点的分裂，完成后释放节点的X锁，父节点如果也需要分裂，就继续这个操作，如果不需要分裂就释放父节点的锁。
